# =============================================================================
# SKYBRIDGE - ENVIRONMENT CONFIGURATION
# =============================================================================
# Copie este arquivo para .env e configure conforme necessário
# Variáveis marcadas com # são opcionais ou possuem valores padrão seguros
# =============================================================================

# =============================================================================
# SERVIDOR - CONFIGURAÇÕES BÁSICAS
# =============================================================================
SKYBRIDGE_HOST=0.0.0.0                    # Host para bind (0.0.0.0 = todas as interfaces)
SKYBRIDGE_PORT=8000                       # Porta do servidor HTTP
SKYBRIDGE_LOG_LEVEL=INFO                  # Nível de log: DEBUG, INFO, WARNING, ERROR, CRITICAL
SKYBRIDGE_DEBUG=false                     # Modo debug (expõe stack traces completas)

# =============================================================================
# NGROK - TÚNEL DE DESENVOLVIMENTO
# =============================================================================
# Documentação: Veja PB002 para configurar URL fixa
# Dashboard: https://dashboard.ngrok.com/get-started/your-authtoken
NGROK_ENABLED=false                       # Habilita túnel ngrok automático
# NGROK_AUTH_TOKEN=your_token_here        # Token de autenticação ngrok
# NGROK_DOMAIN=skybridge-dev.ngrok-free.app  # Domínio reservado (recomendado para persistência)

# =============================================================================
# FILEOPS - ALLOWLIST DE SEGURANÇA
# =============================================================================
# Controla quais diretórios podem ser acessados pelas operações de arquivo
FILEOPS_ALLOWLIST_MODE=dev                # Modo: "dev" (codebase) ou "production" (workspace)
# FILEOPS_DEV_ROOT=B:\_repositorios\skybridge  # Raiz do projeto em modo dev (default: cwd)
# FILEOPS_PROD_ROOT=\workspace            # Raiz do workspace em produção (default: /workspace)

# Webhooks - Branch base para worktrees de agentes
# Branch usada como base para criar worktrees isolados para processar issues
# Padrão: "dev" (ou "main" dependendo do seu fluxo)
WEBHOOK_BASE_BRANCH=dev

# =============================================================================
# AUTENTICAÇÃO E AUTORIZAÇÃO (JSON-RPC)
# =============================================================================
# Configuração de segurança para endpoints RPC
# Suporta múltiplos métodos: API Key, Bearer Tokens, IP Allowlist

# API Keys (Fase 1 - Autenticação simples)
# SKYBRIDGE_API_KEY=change-me             # Chave global única (básico)
# SKYBRIDGE_API_KEYS=key1:clientA;key2:clientB  # Múltiplas chaves por client_id

# Políticas de Acesso por Método
# Formato: client_id:method1,method2;client_id:method1,method2
# Métodos disponíveis:
#   - health: Health check endpoint
#   - fileops.read: Leitura de arquivos
#   - fileops.write: Escrita de arquivos
#   - rpc.discover: Descoberta de métodos RPC disponíveis
#   - snapshot.capture: Captura de snapshots do estado atual
#   - snapshot.compare: Comparação entre snapshots
#   - snapshot.list: Listagem de snapshots armazenados
# Exemplo com múltiplos clients:
# SKYBRIDGE_METHOD_POLICY=global:rpc.discover,health;sky:rpc.discover,health,fileops.read,snapshot.*;pm:health,snapshot.list

# Rate Limiting
SKYBRIDGE_RATE_LIMIT_PER_MINUTE=0         # Limite de requests por minuto (0 = desativado)

# Bypass de Autenticação
ALLOW_LOCALHOST=false                     # Permite requests sem auth de localhost (apenas testes)

# IP Allowlist (opcional)
# SKYBRIDGE_IP_ALLOWLIST=203.0.113.10,198.51.100.5  # Lista de IPs permitidos

# Bearer Tokens (Fase 2 - Autenticação avançada)
# SKYBRIDGE_BEARER_ENABLED=false          # Habilita autenticação via Bearer tokens
# SKYBRIDGE_BEARER_TOKENS=token1:clientA;token2:clientB  # Tokens por client_id

# =============================================================================
# TLS/HTTPS - CONFIGURAÇÕES DE SEGURANÇA ADICIONAL
# =============================================================================
# SKYBRIDGE_SSL_ENABLED=false             # Habilita HTTPS
# SKYBRIDGE_SSL_CERT_FILE=path/to/cert.pem # Caminho para o certificado SSL
# SKYBRIDGE_SSL_KEY_FILE=path/to/key.pem  # Caminho para a chave privada SSL

# =============================================================================
# JOB QUEUE - CONFIGURAÇÕES (PRD018 Fase 2)
# =============================================================================
# Sistema de fila para processamento assíncrono de webhooks
# Documentação: docs/playbook/PB018-Fase2-JobQueue.md

# Job Queue Provider
# Opções: sqlite, dragonfly, redis, file
# sqlite: SQLite nativo (RECOMENDADO - zero dependências, ACID)
# dragonfly: Usa DragonflyDB (alta performance)
# redis: Usa Redis tradicional
# file: Usa FileBasedJobQueue (persistência em arquivos)
JOB_QUEUE_PROVIDER=sqlite

# SQLite Configurações (padrão)
# SQLITE_DB_PATH=data/jobs.db           # Caminho para arquivo SQLite
# SQLITE_TIMEOUT=5.0                     # Timeout para operações (segundos)

# DragonflyDB Configurações (alternativo)
# DRAGONFLY_HOST=localhost
# DRAGONFLY_PORT=6379
# DRAGONFLY_DIR=./data/dragonfly
# DRAGONFLY_LOG_LEVEL=debug

# Redis Configurações (fallback/alternativo)
# REDIS_HOST=localhost
# REDIS_PORT=6379

# =============================================================================
# INTEGRAÇÕES EXTERNAS
# =============================================================================

# GitHub App - Skybridge
# Formatos aceitos: PEM (conteúdo completo do .pem) ou SHA256 (hash da chave)
# GITHUB_APP_PRIVATE_KEY=...              # Chave privada do GitHub App

# Trello API - Contexto Kanban
# Documentação: Configuração para integração com Trello
# TRELLO_API_KEY=your_api_key_here        # Obter em https://trello.com/app-key
# TRELLO_API_TOKEN=your_token_here        # Gerar em https://trello.com/1/connect
# TRELLO_BOARD_ID=your_board_id_here      # ID do board do Trello

# GitHub Integration - GitHub → Trello Flow
# GITHUB_REPO=owner/repo                  # Repositório GitHub (ex: h4mn/skybridge)
# GITHUB_TOKEN=ghp_xxxxxxxxxxxx           # Personal Access Token para API GitHub

# =============================================================================
# FEATURE FLAGS - ROLLOUT GRADUAL
# =============================================================================
# PRD019: Usa Claude Agent SDK ao invés de subprocess (ClaudeCodeAdapter)
# true  → ClaudeSDKAdapter (SDK oficial, 4-5x mais rápido)
# false → ClaudeCodeAdapter (subprocess, fallback para rollback)
USE_SDK_ADAPTER=false

# =============================================================================
# WEBHOOK CONFIGURATION (PRD013)
# =============================================================================
# Configuração para recebimento de webhooks
# WEBHOOK_GITHUB_SECRET=your_secret_here  # Secret para validação de webhooks GitHub
# WEBHOOK_WORKTREE_BASE_PATH=../skybridge-worktrees  # Base path para criação de worktrees
# WEBHOOK_ENABLED_SOURCES=github          # Fontes habilitadas (github, gitlab, etc)

# =============================================================================
# TRELLO WEBHOOK (PRD020 - Fluxo Bidirecional)
# =============================================================================
# Configuração para webhooks do Trello (fluxo reverso Trello → GitHub)
#
# TRELLO_WEBHOOK_SECRET=your_api_secret_here
#   API Secret do Power-Up (obter em https://trello.com/power-ups/admin → aba "API Key")
#   USADO PARA: Verificação HMAC-SHA1 de webhooks
#   IMPORTANTE: Não é o API Token! É o API Secret da aba API Key.
#
# TRELLO_WEBHOOK_CALLBACK_URL=https://seu-dominio.com/webhook/trello
#   URL pública usada na criação do webhook (necessária para verificação!)
#   USADO PARA: Verificar assinatura (fórmula: base64(HMAC-SHA1(payload + callbackURL, secret)))
#   NOTA: Deve ser EXATAMENTE a mesma URL usada em trello_service.setup_webhook()
#
# Documentação: https://developer.atlassian.com/cloud/trello/guides/rest-api/webhooks/
# Fórmula Trello: signature = base64(HMAC-SHA1(payload + callbackURL, secret))
# Diferença GitHub vs Trello:
#   - GitHub: HMAC-SHA256, formato "sha256=<hex>", assina apenas payload
#   - Trello: HMAC-SHA1, formato base64 puro, assina payload + callbackURL

# =============================================================================
# NOTAS
# =============================================================================
# - Valores sensíveis (tokens, chaves) nunca devem ser commitados
# - Use .env.example como template para novas configurações
# - Mantenha este arquivo sincronizado com as variáveis em uso
# =============================================================================

